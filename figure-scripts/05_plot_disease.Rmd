
# Plot infection related outcomes

```{r}
library(data.table)
library(glue)
library(ggplot2)
library(colorspace)
library(patchwork)
```

```{r}
# some parameters
sgen <- 3000
genmax <- 5000
popsize <- 500

# load data
data_infections_gen <- fread("data/results/data_infections_gen.csv")

# subset data
data_infections_gen <- data_infections_gen[scenario_tag == "default"]
data_infections_gen <- data_infections_gen[costInfect == 0.25 &
  regen_time == 50 &
  dispersal == 2]
# data_infections_gen[, gen_bin := round(gen, digits = -2)]

# absolute generations
data_infections_gen[, gen_abs := gen - sgen]

# make smaller bins
# data_infections_gen[, gen_abs := fifelse(
#   abs(gen_abs) < 100, gen - sgen, gen_abs
# )]
```

```{r}
# make figures
fig_gen_infect <-
  ggplot(data_infections_gen[gen >= sgen & gen %% 50 == 0]) +
  stat_bin2d(
    data = data_infections_gen[gen >= sgen],
    aes(
      gen_abs, n_infected / popsize
    ),
    linewidth = 0.1,
    linetype = "dashed",
    show.legend = F
  ) +
  geom_hline(
    yintercept = 0.5,
    col = "grey",
    size = 0.2
  ) +
  stat_summary(
    aes(
      gen_abs, n_infected / popsize
    ),
    fill = "firebrick",
    shape = 21, size = 0.2,
    show.legend = FALSE
  ) +
  scale_fill_continuous_sequential(
    palette = "Reds",
    l1 = 70, l2 = 100,
    c1 = 50, c2 = 10
  ) +
  scale_x_continuous(
    breaks = c(-500, 0, 500, 2000),
    labels = scales::comma_format(
      accuracy = 1
    ),
    name = "Gens. after pathogen intro."
  ) +
  scale_y_continuous(
    labels = scales::percent,
    breaks = c(0.2, 0.5, 0.8),
    name = "% Population infected"
  ) +
  coord_cartesian(
    # xlim = c(NA, 250),
    ylim = c(0.2, 0.8)
  ) +
  theme_test(
    base_family = "Arial",
    base_size = 8
  ) +
  theme(
    axis.text.y = element_text(
      angle = 90,
      hjust = 0.5,
      size = 6
    )
  )
```

```{r}
# add layers
plot_disease <- wrap_plots(
  fig_gen_infect, fig_sir,
  guides = "collect",
  design = "ABB"
) &
  plot_annotation(
    tag_levels = "A"
  ) &
  theme(
    plot.tag = element_text(face = "bold"),
    legend.position = "top"
  )

ggsave(
  plot_disease,
  filename = "figures/fig_disease.png",
  width = 160, height = 70, units = "mm"
)
```
